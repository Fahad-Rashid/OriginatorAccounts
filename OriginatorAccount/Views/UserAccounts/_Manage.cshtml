@using OriginatorAccount.Models.UserSubAccount
@model  VMUserSubAccountParent


<script src="@Url.Content("~/Scripts/jquery.validate.min.js")"
        type="text/javascript">
</script>

<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")"
        type="text/javascript">
</script>


    <div id="main-content">
        <div class="container-fluid">
            <div class="block-header">
                <div class="row">
                    <div class="col-lg-6 col-md-8 col-sm-12">
                        <h2><a href="javascript:void(0);" class="btn btn-xs btn-link btn-toggle-fullwidth"><i class="fa fa-arrow-left"></i></a>User Accounts List</h2>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"><i class="icon-home"></i></a></li>
                            <li class="breadcrumb-item">User Accounts</li>
                            <li class="breadcrumb-item active">User Accounts List</li>
                        </ul>
                    </div>
                    @*<div class="col-lg-6 col-md-4 col-sm-12 text-right">
                    <div class="bh_chart hidden-xs">
                        <div class="float-left m-r-15">
                            <small>Visitors</small>
                            <h6 class="mb-0 mt-1"><i class="icon-user"></i> 1,784</h6>
                        </div>
                        <span class="bh_visitors float-right">2,5,1,8,3,6,7,5</span>
                    </div>
                    <div class="bh_chart hidden-sm">
                        <div class="float-left m-r-15">
                            <small>Visits</small>
                            <h6 class="mb-0 mt-1"><i class="icon-globe"></i> 325</h6>
                        </div>
                        <span class="bh_visits float-right">10,8,9,3,5,8,5</span>
                    </div>
                    <div class="bh_chart hidden-sm">
                        <div class="float-left m-r-15">
                            <small>Chats</small>
                            <h6 class="mb-0 mt-1"><i class="icon-bubbles"></i> 13</h6>
                        </div>
                        <span class="bh_chats float-right">1,8,5,6,2,4,3,2</span>
                    </div>
                </div>*@
                </div>
            </div>

            
                <div class="row clearfix">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="header">
                                <h2>User Accounts List</h2>
                                <ul class="header-dropdown">
                                    <li><a href="javascript:void(0);" class="btn btn-info" id="AddAccount">Add New</a></li>
                                </ul>
                            </div>

                            @if (ViewBag.RoleId == 5)
                            {
                                <div class="col-md-3">
                                    <div class="form-group">
                                        @Html.DropDownList("Company", (IEnumerable<SelectListItem>)ViewBag.Companies, "- Select Company -", new { @class = "form-control" })
                                    </div>
                                </div>
                                <div id="Userdiv" class="col-md-3">

                                </div>
                            }


                            <div class="body">
                                @if (ViewBag.RoleId != 5)
                                {
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            @Html.DropDownListFor(m => m.UserId, (IEnumerable<SelectListItem>)ViewBag.Users, "- Select User -", new { @class = "form-control" })
                                        </div>
                                    </div>
                                }

                                <div class="table-responsive">
                                    <table id="tblOne" class="table table-hover js-basic-example dataTable table-custom table-striped m-b-0 c_list">
                                        <thead class="thead-dark">
                                            <tr>
                                                <th>Account Name</th>
                                                <th>Account Number</th>
                                                <th>Default From Account</th>
                                                <th>Default To Account</th>
                                                <th>From Associated</th>
                                                <th>To Associated</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model != null)
                                            {
                                                if (Model.UserSubAccounts != null)
                                                {
                                                    foreach (var m in Model.UserSubAccounts)
                                                    {
                                                        <tr>
                                                            <td>@Html.DisplayFor(c => m.SubAccountName)</td>
                                                            <td>@Html.DisplayFor(c => m.AccountNumber)</td>
                                                            <td>
                                                                @if (m.DefaultFromId == 1)
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick DefaultFrom" type="checkbox" name="checkbox" checked="checked">
                                                                        <span></span>
                                                                    </label>
                                                                }
                                                                else
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick DefaultFrom" type="checkbox" name="checkbox">
                                                                        <span></span>
                                                                    </label>
                                                                }

                                                            </td>
                                                            <td>
                                                                @if (m.DefaultToId == 1)
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick DefaultTo" type="checkbox" name="checkbox" checked="checked">
                                                                        <span></span>
                                                                    </label>
                                                                }
                                                                else
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick DefaultTo" type="checkbox" name="checkbox">
                                                                        <span></span>
                                                                    </label>
                                                                }

                                                            </td>
                                                            <td>
                                                                @if (m.FromAssociatedId == "1")
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick FromAssociated" type="checkbox" name="checkbox" checked="checked">
                                                                        <span></span>
                                                                    </label>
                                                                }
                                                                else
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick FromAssociated" type="checkbox" name="checkbox">
                                                                        <span></span>
                                                                    </label>
                                                                }
                                                            </td>
                                                            <td>
                                                                @if (m.ToAssociatedId == "1")
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick ToAssociated" type="checkbox" name="checkbox" checked="checked">
                                                                        <span></span>
                                                                    </label>
                                                                }
                                                                else
                                                                {
                                                                    <label class="fancy-checkbox">
                                                                        <input class="checkbox-tick ToAssociated" type="checkbox" name="checkbox">
                                                                        <span></span>
                                                                    </label>
                                                                }

                                                            </td>


                                                            @*<td class="width45">
                                            @Html.CheckBoxFor(c => m.DefaultFrom, new { @class = "form-control", name = "CheckBoxDefaultFrom" })
                                        </td>
                                        <td class="width45">
                                            @Html.CheckBoxFor(c => m.DefaultTo, new { @class = "form-control", name = "CheckBoxDefaultFrom" })
                                        </td>
                                        <td class="width45">
                                            @Html.CheckBoxFor(c => m.FromAssociated, new { @class = "form-control CheckBox-Tick" })
                                        </td>
                                        <td class="width45">
                                            @Html.CheckBoxFor(c => m.ToAssociated, new { @class = "form-control" })
                                        </td>*@
                                                        </tr>
                                                    }

                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <button type="button" id="UpdateUserSubAccounts" class="btn btn-primary pull-right ">UPDATE</button>
                        </div>
                    </div>
                </div>
            
        </div>
            
    </div>



    <script type="text/javascript">
        var empIds = [];
        $("#UserId").change(function () {
            $(".loaderjif").show();
            var UserId = $('#UserId option:selected').val();
            var RoleId = @Html.Raw(Json.Encode(ViewBag.RoleId));
            if (RoleId == 5) {
                var CompanyId = $('#Company option:selected').val();
                $.ajax(
                    {
                        url: "/UserAccounts/GetUserSubAccounts",
                        type: "get",
                        data: {
                            Id: UserId,
                            CompanyId: CompanyId
                        }
                    }
                ).done(function (result) {
                    $(".loaderjif").hide();
                    $("#PutData").html(result);
                });
            }
            else
            {
                $.ajax(
                    {
                        url: "/UserAccounts/GetUserSubAccounts",
                        type: "get",
                        data: {
                            Id: UserId,
                            CompanyId: 0
                        }
                    }
                ).done(function (result) {
                    $(".loaderjif").hide();
                    $("#PutData").html(result);
                });
            }

            
        });


        $("#Company").change(function () {
            var CompanyId = $('#Company option:selected').val();
            $.ajax(
                {
                    url: "/User/GetUser/" + CompanyId
                }
            ).done(function (Users) {
                $("#Userdiv").html(Users);
                $("#User").change(function () {
                    $(".loaderjif").show();
                    var UserId = $('#User option:selected').val();
                    var CompanyId = $('#Company option:selected').val();
                    $.ajax(
                        {
                            url: "/UserAccounts/GetUserSubAccounts",
                            type: "get",
                            data: {
                                Id: UserId,
                                CompanyId: CompanyId
                            }
                        }
                    ).done(function (result) {
                        $(".loaderjif").hide();
                        $("#PutData").html(result);
                    });
                });
            });
        });

        
        
        $("#tblOne tr").each(function () {
            var ThisRowAccountNumber = $(this).closest('tr').find('td').eq(1).text().trim();
            if ($(this).closest('tr').find('td:eq(2) input').is(':checked')) {
                empIds.push('DF' + "|" + ThisRowAccountNumber);
            }
            if ($(this).closest('tr').find('td:eq(3) input').is(':checked')) {
                empIds.push('DT' + "|" + ThisRowAccountNumber);
            }
            if ($(this).closest('tr').find('td:eq(4) input').is(':checked')) {
                empIds.push('FA' + "|" + ThisRowAccountNumber);
            }
            if ($(this).closest('tr').find('td:eq(5) input').is(':checked')) {
                empIds.push('TA' + "|" + ThisRowAccountNumber);
            }
        });



        
        $("#UpdateUserSubAccounts").click(function () {
            empIds.push($('#UserId option:selected').val());
            $.ajax(
                {
                    url: "/UserAccounts/UpdateUserSubAccounts/" + empIds.join(','),
                    success: function (response) {
                    /* invoke your function*/
                        $("#PutData").html(response);
                    }
                });
        });



        $('input.DefaultFrom').on('change', function () {
            var arr = empIds;

            if ($(this).closest('tr').find('td:eq(4) input').is(':checked')) {
                var DefaultFromAccountNumber = $(this).closest('tr').find('td').eq(1).text().trim();

                var flag = false;
                var i = 0;
                for (i = 0; i < arr.length; i++) {
                    var MyString = arr[i].toString();
                    var Current = MyString.split('|', 1);
                    if (Current == "DF") {
                        flag = true;
                        break
                    }
                    else {
                        flag = false;
                    }
                }

                if (flag) {
                    arr.splice(i, 1);
                    arr.push('DF' + "|" + DefaultFromAccountNumber);
                } else {
                    arr.push('DF' + "|" + DefaultFromAccountNumber);
                }
                arr = empIds;
                $('input.DefaultFrom').not(this).prop('checked', false);
            } else {
                alert("Not Selected Associated From");
                $(this).closest('tr').find('td:eq(2) input').prop('checked', false);
            }

        });

        $('input.DefaultTo').on('change', function () {
            var arr = empIds;
            if ($(this).closest('tr').find('td:eq(5) input').is(':checked')) {
                var DefaultToAccountNumber = $(this).closest('tr').find('td').eq(1).text().trim();
                
                var flag = false;
                
                    var i = 0;
                for (i = 0; i < arr.length; i++) {
                    var MyString = arr[i].toString();
                    var Current = MyString.split('|',1);
                    if (Current == "DT") {
                        flag = true;
                        break
                    }
                    else {
                        flag = false;
                    }
                }
                    
                if (flag) {
                    arr.splice(i, 1);
                    arr.push('DT' + "|" + DefaultToAccountNumber);

                } else {
                    arr.push('DT' + "|" + DefaultToAccountNumber);
                }
                arr = empIds;
                $('input.DefaultTo').not(this).prop('checked', false);
            } else {
                alert("Not Selected As Associated To");
                $(this).closest('tr').find('td:eq(3) input').prop('checked', false);
            }
        });


        $('input.FromAssociated').on('change', function () {
            var arr = empIds;
            $(this).closest('tr').find('td:eq(2) input').prop('checked', false);
            var FromAssociatedAccountNumber = $(this).closest('tr').find('td').eq(1).text().trim();
            var flag = false;
            var EqualToThis = ('DF' + "|" + FromAssociatedAccountNumber);
            var i = 0;
            for (i = 0; i < arr.length; i++) {
                if (arr[i] == EqualToThis) {
                    flag = true;
                    break
                }
                else {
                    flag = false;
                }
            }
            if (flag) {
                arr.splice(i, 1);

                var slag = false;
                var Equal = ('FA' + "|" + FromAssociatedAccountNumber);
                var j = 0;
                for (j = 0; j < arr.length; j++) {
                    if (arr[j] == Equal) {
                        slag = true;
                        break
                    }
                    else {
                        slag = false;
                    }
                }

                if (slag) {
                    arr.splice(j, 1);
                }

                
            } else {

                var tlag = false;
                var Equal = ('FA' + "|" + FromAssociatedAccountNumber);
                var k = 0;
                for (k = 0; k < arr.length; k++) {
                    if (arr[k] == Equal) {
                        tlag = true;
                        break
                    }
                    else {
                        tlag = false;
                    }
                }

                if (tlag) {
                    arr.splice(k, 1);
                } else {
                    arr.push('FA' + "|" + FromAssociatedAccountNumber);
                }
                
            }
            

            arr = empIds;
        });


        $('input.ToAssociated').on('change', function () {
            var arr = empIds;
            $(this).closest('tr').find('td:eq(3) input').prop('checked', false);
            var ToAssociatedAccountNumber = $(this).closest('tr').find('td').eq(1).text().trim();
            var flag = false;
            var EqualToThis = ('DT' + "|" + ToAssociatedAccountNumber);
            var i = 0;
            for (i = 0; i < arr.length; i++) {
                if (arr[i] == EqualToThis) {
                    flag = true;
                    break
                }
                else {
                    flag = false;
                }
            }
            if (flag) {
                arr.splice(i, 1);
                var slag = false;
                var Equal = ('TA' + "|" + ToAssociatedAccountNumber);
                var j = 0;
                for (j = 0; j < arr.length; j++) {
                    if (arr[j] == Equal) {
                        slag = true;
                        break
                    }
                    else {
                        slag = false;
                    }
                }

                if (slag) {
                    arr.splice(j, 1);
                }

            } else {

                var tlag = false;
                var Equal = ('TA' + "|" + ToAssociatedAccountNumber);
                var k = 0;
                for (k = 0; k < arr.length; k++) {
                    if (arr[k] == Equal) {
                        tlag = true;
                        break
                    }
                    else {
                        tlag = false;
                    }
                }

                if (tlag) {
                    arr.splice(k, 1);
                } else {
                    arr.push('TA' + "|" + ToAssociatedAccountNumber);
                }
            }

            
            arr = empIds;
        });



        //$(".CheckEmployee").click(function (e) {
        //    var EmployeesCount = 0;
        //    $("#tblOne .CheckEmployee").each(function () {
        //        if ($(this).closest('tr').find('td:eq(0) input').is(':checked')) {
        //            EmployeesCount = EmployeesCount + 1;
        //        }
        //    });
        //    if (EmployeesCount < GangLimit + 1) {
        //        $(this).closest('tr').find('td:eq(9) input').prop('checked', false);
        //        $(this).closest('tr').find('td:eq(10) input').prop('checked', false);
        //        //FormanId = 0;
        //        //SubFormanId = 0;
        //        var arr = empIds;
        //        var checkedId = $(this).closest('tr').find('td').eq(1).text().trim();
        //        if ($(this).prop('checked')) {
        //            empIds.push(checkedId);
        //            arr = empIds;
        //        }
        //        else {
        //            jQuery.each(empIds, function (i, item) {
        //                if (arr[i] == checkedId) {
        //                    arr.splice(i, 1);
        //                }
        //            });
        //            empIds = arr;
        //        }
        //        var ids = "";
        //        jQuery.each(empIds, function (i, item) {
        //            if (ids == "") {
        //                ids = empIds[i];
        //            }
        //            else {
        //                ids = ids + "," + empIds[i];
        //            }
        //        });
        //    } else {
        //        $(this).closest('tr').find('td:eq(0) input').prop('checked', false);
        //        showMessageClient("error", "Max " + GangLimit + " Members in Gang", "bottom-right");
        //    }

        //});





    </script>


